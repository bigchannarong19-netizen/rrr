<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TCAS Practice</title>
    <style>
         :root {
            --pink: #f472b6;
            --blue: #60a5fa;
            --bg: linear-gradient(135deg, var(--pink) 0%, var(--blue) 100%);
            --card-bg: #ffffff;
            --text: #1f2937;
        }
        
        body {
            font-family: "Segoe UI", sans-serif;
            margin: 0;
            min-height: 100vh;
            background: var(--bg);
            display: flex;
            flex-direction: column;
        }
        
        header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(6px);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem 1.5rem;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .logo {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--text);
        }
        
        nav a {
            margin-left: 1rem;
            text-decoration: none;
            color: var(--text);
            font-weight: 500;
            transition: color 0.2s;
        }
        
        nav a:hover {
            color: var(--blue);
        }
        
        main {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        
        .card {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            width: 100%;
            max-width: 900px;
            animation: fadeIn 0.3s ease;
        }
        
        h2,
        h3,
        p {
            color: var(--text);
        }
        
        .btn {
            background: var(--blue);
            color: white;
            padding: 0.7rem 1.4rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin: 0.3rem;
            font-size: 1rem;
            font-weight: 500;
            transition: 0.2s;
        }
        
        .btn:hover {
            background: #1d4ed8;
        }
        
        select {
            padding: 0.5rem;
            margin: 0.5rem;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        th,
        td {
            border: 1px solid #e5e7eb;
            padding: 0.6rem;
            text-align: center;
        }
        
        th {
            background: #f3f4f6;
        }
        
        .study-plan {
            margin-top: 1rem;
            padding: 1rem;
            background: #f9fafb;
            border-radius: 12px;
        }
        
        .option {
            border: 2px solid #e5e7eb;
            padding: 1rem;
            border-radius: 12px;
            margin: 0.5rem 0;
            cursor: pointer;
            transition: 0.2s;
        }
        
        .option:hover {
            background: #f9fafb;
            border-color: var(--blue);
        }
        
        .correct {
            background: #d1fae5 !important;
            border-color: #10b981 !important;
        }
        
        .wrong {
            background: #fee2e2 !important;
            border-color: #ef4444 !important;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body>
    <!-- üîπ Navbar -->
    <header>
        <div class="logo">üìò TCAS Practice</div>
        <nav>
            <a href="#" onclick="goHome()">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
            <a href="#" onclick="goIntro()">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</a>
            <a href="#" onclick="backToMenu()">‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î</a>
            <a href="#" onclick="goStats()">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</a>
            <a href="#" onclick="goUniversity()">‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢</a>
            <a href="#" onclick="goAccount()">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</a>
        </nav>
    </header>

    <main id="app">
        <div class="card">
            <h2>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</h2>
            <div id="exam-menu"></div>
        </div>
    </main>

    <!-- ‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• TCAS -->
    <script src="examData_full.js"></script>
    <script src="tcas-data-browser.js"></script>

    <script>
        // ================== ‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î ==================
        const examList = Object.keys(examData);
        const menu = document.getElementById("exam-menu");
        menu.innerHTML = examList.map(e =>
            `<button class="btn" onclick="startExam('${e}')">${e}</button>`
        ).join("");

        let questions = [];
        let qIndex = 0,
            score = 0,
            currentExam = "";

        function startExam(examName) {
            currentExam = examName;
            questions = examData[examName];
            qIndex = 0;
            score = 0;
            renderQuestion();
        }

        function renderQuestion() {
            const q = questions[qIndex];
            document.getElementById("app").innerHTML = `
        <div class="card">
          <h3>${currentExam} | ‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà ${qIndex + 1}/${questions.length}</h3>
          <p>${q.stem}</p>
          <div>
            ${q.choices.map((c,i)=>`<div class="option" onclick="answer(${i})">${c}</div>`).join("")}
          </div>
        </div>`;
    }

    function answer(i) {
      const q = questions[qIndex];
      const opts = document.querySelectorAll(".option");
      opts.forEach((opt,idx)=>{
        if(idx===q.answer) opt.classList.add("correct");
        else if(idx===i) opt.classList.add("wrong");
        opt.onclick=null;
      });
      if(i===q.answer) score++;
      setTimeout(()=>{
        qIndex++;
        if(qIndex < questions.length) renderQuestion();
        else showResult();
      }, 1000);
    }

    function showResult() {
      const percent = ((score/questions.length)*100).toFixed(1);
      saveResult(currentExam, score, questions.length, percent);
      document.getElementById("app").innerHTML = `
        <div class="card">
          <h2>‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå - ${currentExam}</h2>
          <p>‡∏ñ‡∏π‡∏Å ${score} ‡∏à‡∏≤‡∏Å ${questions.length} ‡∏Ç‡πâ‡∏≠ (${percent}%)</p>
          <button class="btn" onclick="backToMenu()">‚¨Ö ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π</button>
        </div>`;
    }

    function backToMenu() {
      document.getElementById("app").innerHTML = `
        <div class="card">
          <h2>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</h2>
          <div id="exam-menu">
            ${examList.map(e => `<button class="btn" onclick="startExam('${e}')">${e}</button>`).join("")}
          </div>
        </div>`;
    }

    // ================== ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ ==================
    function saveResult(exam, score, total, percent) {
      const record = { exam, score, total, percent, date: new Date().toLocaleString("th-TH") };
      let stats = JSON.parse(localStorage.getItem("examStats") || "[]");
      stats.push(record);
      localStorage.setItem("examStats", JSON.stringify(stats));
    }
    function goStats() {
      const stats = JSON.parse(localStorage.getItem("examStats") || "[]");
      if (stats.length === 0) {
        document.getElementById("app").innerHTML = `<div class="card"><h2>üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</h2><p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p></div>`;
        return;
      }
      document.getElementById("app").innerHTML = `
        <div class="card">
          <h2>üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</h2>
          <table>
            <tr><th>‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</th><th>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th><th>‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå</th><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥</th></tr>
            ${stats.map(r=>`<tr><td>${r.exam}</td><td>${r.score}/${r.total}</td><td>${r.percent}%</td><td>${r.date}</td></tr>`).join("")}
          </table>
          <button class="btn" onclick="clearStats()">‡∏•‡πâ‡∏≤‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</button>
        </div>`;
    }
    function clearStats() { localStorage.removeItem("examStats"); goStats(); }

    // ================== ‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢ ==================
    function goUniversity() {
      document.getElementById("app").innerHTML = `
        <div class="card">
          <h2>üéì ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ì‡∏∞</h2>
          <label>‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢:</label>
          <select id="uniSelect" onchange="loadFaculties()">
            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢ --</option>
            ${tcasData.universities.map(u => `<option value="${u.id}">${u.name}</option>`).join("")}
          </select>
          <label>‡∏Ñ‡∏ì‡∏∞:</label>
          <select id="facultySelect" onchange="showUniversityInfo()"><option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ì‡∏∞ --</option></select>
          <div id="uniInfo"></div>
        </div>`;
    }

    function loadFaculties() {
      const uniId = document.getElementById("uniSelect").value;
      const facSel = document.getElementById("facultySelect");
      facSel.innerHTML = `<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ì‡∏∞ --</option>`;
      if (uniId) {
        const uni = tcasData.universities.find(u => u.id == uniId);
        uni.faculties.forEach(f => {
          facSel.innerHTML += `<option value="${f.id}">${f.name}</option>`;
        });
      }
      document.getElementById("uniInfo").innerHTML = "";
    }

    function showUniversityInfo() {
      const uniId = document.getElementById("uniSelect").value;
      const facId = document.getElementById("facultySelect").value;

      const uni = tcasData.universities.find(u => u.id == uniId);
      const fac = uni.faculties.find(f => f.id == facId);

      if (!fac) return;

      const safeList = arr => arr.map(r => `<li>${r.name || r}</li>`).join("");

      let html = `<h3>${uni.name} - ${fac.name}</h3>`;
      if (fac.rounds) {
        html += `<h4>‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö</h4><ul>${safeList(fac.rounds)}</ul>`;
      }
      if (fac.requirements) {
        html += `<h4>‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ</h4><ul>${safeList(fac.requirements)}</ul>`;
      }
      if (fac.schedule) {
        html += `<h4>‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£</h4>
          <table>
            <tr><th>‡πÄ‡∏£‡∏¥‡πà‡∏°</th><th>‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</th><th>‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ú‡∏•</th><th>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</th><th>‡∏™‡∏•‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</th></tr>
            <tr>
              <td>${fac.schedule.start || "-"}</td>
              <td>${fac.schedule.end || "-"}</td>
              <td>${fac.schedule.result || "-"}</td>
              <td>${fac.schedule.confirm || "-"}</td>
              <td>${fac.schedule.withdraw || "-"}</td>
            </tr>
          </table>`;
      }
      document.getElementById("uniInfo").innerHTML = html;
    }

    // ================== Navbar ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ==================
    function goHome() {
      document.getElementById("app").innerHTML =
        `<div class="card"><h2>üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</h2><p>‡∏£‡∏∞‡∏ö‡∏ö TCAS ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏Ñ‡∏±‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏Å‡∏•‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡πÑ‡∏ó‡∏¢</p></div>`;
    }
    function goIntro() {
      document.getElementById("app").innerHTML =
        `<div class="card"><h2>‚ÑπÔ∏è ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h2><p>‡∏î‡∏π‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏£‡∏∞‡∏ö‡∏ö TCAS</p>
         <div style="position:relative;padding-bottom:56.25%;height:0;overflow:hidden;border-radius:12px;">
         <iframe src="https://www.youtube.com/embed/vkKaRAZ-u8E" frameborder="0" allowfullscreen
         style="position:absolute;top:0;left:0;width:100%;height:100%;"></iframe></div></div>`;
    }

    // ================== ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ==================
    function saveAccount(name, imgUrl) {
      localStorage.setItem("userName", name);
      localStorage.setItem("userImg", imgUrl);
    }

    function loadAccount() {
      return {
        name: localStorage.getItem("userName") || "",
        img: localStorage.getItem("userImg") || ""
      };
    }

    function goAccount() {
      const user = loadAccount();
      if (user.name && user.img) {
        document.getElementById("app").innerHTML = `
          <div class="card" style="text-align:center">
            <img src="${user.img}" alt="profile" style="width:100px;height:100px;border-radius:50%;object-fit:cover;margin-bottom:1rem;">
            <h2>üë§ ${user.name}</h2>
            <button class="btn" onclick="logout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
          </div>`;
      } else {
        document.getElementById("app").innerHTML = `
          <div class="card" style="text-align:center">
            <h2>üë§ ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h2>
            <input type="text" id="nameInput" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠" style="padding:0.5rem;width:80%;margin:0.5rem 0;">
            <input type="file" id="imgInput" accept="image/*" style="margin:0.5rem 0;">
            <br>
            <button class="btn" onclick="saveProfile()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
          </div>`;
      }
    }

    function saveProfile() {
      const name = document.getElementById("nameInput").value;
      const file = document.getElementById("imgInput").files[0];
      if (!name || !file) {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ");
        return;
      }
      const reader = new FileReader();
      reader.onload = function(e) {
        saveAccount(name, e.target.result);
        goAccount();
      };
      reader.readAsDataURL(file);
    }

    function logout() {
      localStorage.removeItem("userName");
      localStorage.removeItem("userImg");
      goAccount();
    }
    </script>
</body>

</html>